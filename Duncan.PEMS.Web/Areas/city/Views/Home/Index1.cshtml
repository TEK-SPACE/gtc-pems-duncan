@using Duncan.PEMS.DataAccess.RBAC
@using Duncan.PEMS.Utilities
@using Kendo.Mvc.UI
@model List<Duncan.PEMS.Entities.News.NewsItem>

@{
    ViewBag.Title = @HttpContext.Current.GetLocaleResource( ResourceTypes.PageTitle, "PEMS City Home Page" );
}

@section Styles
{
    
    @Styles.Render("~/css/Kendo") <style type="text/css"> .disabled {
        background-color: #F5F5F5 !important;
    }

    ready .filter-SearchButton {
        background-color: #33BAB1 !important;
        border: 1px solid #00A99D !important;
    }

    .k-grid-header .k-header {
        overflow: visible;
        white-space: normal;
    }

    .k-pager-wrap .k-dropdown {
        width: 75px !important;
    }


    #legendTitle {
        width: 223px;
        height: 27px;
        margin: 0px;
        padding-right: 5px;
        display: none;
        font-family: "futura-pt-n4", "futura-pt", Arial, sans-serif;
        font-weight: 400;
        font-size: 16px;
    }

    #legendPanel {
        width: 226px;
        height: 275px;
        background: #fff;
        background-color: #fff;
        padding: 0px;
        margin: 0px;
        margin-right: 0px;
        border: solid;
        border-color: darkgray;
        border-width: thin;
        display: inline;
        overflow: scroll;
    }

    .legendHeaders {
        margin-left: 5px;
        margin-top: 5px;
        margin-bottom: 2px;
    }


    .legImg {
        float: left;
    }

    .legendLabels {
        /*font-family:Arial;*/
        /*font-weight:normal;*/
        font-size: 11px;
        margin: 0px;
        margin-left: 5px;
    }

    #legendTitle {
        background-color: #174A7D;
        margin: 0px;
        color: white;
    }

    .header {
        height: 5px;
        background: #F0F0F0;
        border: 1px solid #CCC;
        width: 960px;
        /*margin:0px auto;*/
    }


    .DBHolder {
        border-radius: 2px;
        background: #f5f5f5;
        padding: 20px;
        width: 100%;
        height: 151px;
    }

    .DBHolderChart {
        border-radius: 2px;
        background: #f5f5f5;
        padding: 20px;
        width: 100%;
        height: 200px;
    }

    .DB1 {
        margin: 10px;
        margin-top: 1px;
        padding: 0;
        width: 232px;
        height: 150px;
        -webkit-box-shadow: 8px 10px 10px rgba(0,0,0,0.5), inset 8px 10px 10px #ccc;
        -moz-box-shadow: 8px 10px 10px rgba(0,0,0,0.5), inset 8px 10px 10px #ccc;
        box-shadow: 8px 10px 10px rgba(0,0,0,0.5), inset 1px 1px 1px #ccc;
        background: white;
    }

    .DB2 {
        margin: 10px;
        margin-top: 1px;
        padding: 0;
        width: 311px;
        height: 195px;
        -webkit-box-shadow: 8px 10px 10px rgba(0,0,0,0.5), inset 8px 10px 10px #ccc;
        -moz-box-shadow: 8px 10px 10px rgba(0,0,0,0.5), inset 8px 10px 10px #ccc;
        box-shadow: 8px 10px 10px rgba(0,0,0,0.5), inset 1px 1px 1px #ccc;
        background: white;
    }

    .today {
        padding: 2px 4px;
        border: none;
        width: 35px;
        height: 17px;
        margin-top: 8px;
        color: white;
        border-radius: 1px;
        font-family: Arial;
        font-size: 10px;
        background-color: #00a2e8;
    }

    .todayGreen {
        padding: 2px 4px;
        border: none;
        width: 35px;
        height: 17px;
        margin-top: 8px;
        color: white;
        border-radius: 1px;
        font-family: Arial;
        font-size: 10px;
        background-color: #3ec770;
    }

    .todayOrange {
        padding: 2px 4px;
        border: none;
        width: 39px;
        height: 17px;
        margin-top: 8px;
        color: white;
        border-radius: 1px;
        font-family: Arial;
        font-size: 10px;
        background-color: #ff6112;
    }

    .weekly {
        padding: 2px 4px;
        border: none;
        width: 39px;
        height: 17px;
        margin-top: 8px;
        color: white;
        border-radius: 1px;
        font-family: Arial;
        font-size: 10px;
        background-color: #d41558;
    }






    </style>
}

@section Scripts
{

    <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>

    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>   <!-- Added by Sai on May 28th 2013 -->
    <script type="text/javascript" src="/scripts/markermanager_packed.js"></script> <!-- Added by Sai on June 26th 2013 -->
    <script type="text/javascript" src="/scripts/maplabel-compiled.js"></script> <!-- Added by Sai on July 10th 2013 -->
    <script type="text/javascript" src="/scripts/spin.min.js"></script> <!-- Added by Sai on July 2nd 2013 -->
    <script src="/scripts/nscgis.js"></script>  <!-- Added by Sai on May 28th 2013 -->
    <script type="text/javascript" src="~/Scripts/html2canvas.js"></script>
    <script type="text/javascript" src="/scripts/Kendo/kendo.all.min.js"></script>

    <script>

        var myMeterCnt;
        var spinner;
        var isLegendDisplayed = false;
        var ROOT = '@Url.Content("~/")';

        var isAssetTypeLoaded = false;
        var isAssetStatusLoaded = false;
        var isLocationTypeLoaded = false;
        var isDemandZonesLoaded = false;
        var isLayer2_SpecCriteriaLoaded = false;
        var isLayer2_ComplianceLoaded = false;
        var isLayer3_SpecCriteriaLoaded = false;


        var legendImagesArr = [
                           //** Inventory Layer Icons
                           ROOT + 'Images/msm_high_demand.png',
                           ROOT + 'Images/msm_low_demand.png',
                           ROOT + 'Images/msm_low_medium_demand.png',
                           ROOT + 'Images/msm_medium_high_demand.png',

                           ROOT + 'Images/sensor_high_demand.png',
                           ROOT + 'Images/sensor_low_demand.png',
                           ROOT + 'Images/sensor_low_medium_demand.png',
                           ROOT + 'Images/sensor_medium_high_demand.png',

                           ROOT + 'Images/gateway_high_demand.png',
                           ROOT + 'Images/gateway_low_demand.png',
                           ROOT + 'Images/gateway_low_medium_demand.png',
                           ROOT + 'Images/gateway_medium_high_demand.png',

                           ROOT + 'Images/space_high_demand.png',
                           ROOT + 'Images/space_low_demand.png',
                           ROOT + 'Images/space_low_med_demand.png',
                           ROOT + 'Images/space_med_high_demand.png',

                           //** High Demand Parking Bays Layer Icons
                           ROOT + 'Images/Occupied.png',
                           ROOT + 'Images/vacant.png',
                           ROOT + 'Images/Compliant.png',
                           ROOT + 'Images/Non_Compliant.png',

                           //** Parking Meter Operations Layer Icons
                           ROOT + 'Images/Inactive.png',
                           ROOT + 'Images/Operational.png',
                           ROOT + 'Images/Non_Operational_With_Alarm.png',
                           ROOT + 'Images/Operational_With_Alarm.png',
                           ROOT + 'Images/Non_Operational_With_Special_Event.png',
                           ROOT + 'Images/Non_Operational_With_Work_Zone.png',
                           ROOT + 'Images/Non_Operational_With_Maintenance.png',

                           //**Single Space Meter Layer Icons
                           ROOT + 'Images/ssm_high_demand.png',
                           ROOT + 'Images/ssm_low_demand.png',
                           ROOT + 'Images/ssm_low_medium_demand.png',
                           ROOT + 'Images/ssm_medium_high_demand.png',

                           //** Parking Space for Inventories
                           ROOT + 'Images/parkspace_high_demand.png',
                           ROOT + 'Images/parkspace_low_demand.png',
                           ROOT + 'Images/parkspace_low_medium_demand.png',
                           ROOT + 'Images/parkspace_medium_high_demand.png'

        ]



    </script>

     @Scripts.Render("~/bundles/kendo")

      <script>
    var tMeter = 0;
    var aMeter = 0;
    var cMeter = 0;
    var aaMeter = 0;
    var lBattery = 0;
    var enabledAssetsArr = [];
    $(document).ready(function () {

        var myCustomerId = '@ViewBag.CurrentCityID';
        if (myCustomerId == 5001) {
            //** It is NOLA Customer and hence remove help btn temporarily as requested by Justin (DTPEMS-160)
            $('a#help').css('display', 'none');
        }

        //** Get the Lat and Lng details of Customer and load the map accordingly.
        loadGoogleMap('@ViewBag.Latitude', '@ViewBag.Longitude');
        orleans('@ViewBag.CurrentCityID');
        //** First get the list of 'Enabled' asset types for the customer


        FetchEnabledAssetTypes();
        TotalmeterCount();
        //meterCount();

        InActmeterCount();
        //ActalarmCount();
        //SeverAlarmCount();
        //MajorAlarmCount();
        //MinorAlarmCount();
        //InActalarmCount();
        //ActCommMeterCount();
        //ActNonCommMeterCount();
        //BttrChangeRep();
        //PlanBttrChangeRep();
    });

    function FetchEnabledAssetTypes() {
        $.ajax({
            type: "GET",
            // url: '@Url.Action("GetAssetTypes_Inventory", "GIS")',
            url: '@Url.Action("GetAssetTypes_HomePage", "GIS")',

            data: SetLayerId(),
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            success: function (Data) {
                $.each(Data, function (index, value) {
                    enabledAssetsArr.push(Data[index].Value) //** This array contains enabled metergroup IDs
                });

                //** In order to plot enabled inventories for the customer, invoke the controller action for inventory
                invokeInventoryActionMethod();
                invokeParkingSpaceActionMethod();


            }
        });
    }

    function SetLayerId() {
        var layerID = "1";
        return { LayerID: layerID }
    }

    function invokeParkingSpaceActionMethod() {
        $.ajax({
            type: "GET",
            url: '@Url.Action("GetCustomerGridDetails_NewHome", "GIS")',
            data: GetAllFilterData_Parkingspaces(),
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            success: function (Data) {
                zoomCustomerToCenter('@ViewBag.Latitude', '@ViewBag.Longitude')
                redrawMap();
                if (isLegendDisplayed == false) {
                    showLegendPanel();
                    isLegendDisplayed = true;
                    $('#legendPanel').scroll();

                    loadLegendDetails();
                }

                //** Declare an array to hold all inventory layer markers
                var markerArr = [];

                //$.each(Data.Data, function (index, value) {
                //    markerArr.push(Data.Data[index]) //** This array contains lat and lng objects
                //});

                $.each(Data, function (index, value) {
                    markerArr.push(Data[index]) //** This array contains lat and lng objects
                });

                executeClearPOI_HDPB() //** Clear all the OLD data POI on the map for the respective layers


                var layerValue = $("#layerDropDown").val();

                plotMarkers_HighDemandBays(markerArr, legendImagesArr, "Home") //** '1' indicates inventory layer




            },
            error: function () {
                //alert("An error occurred while processing XML file.");
            }
        });
    }

    function invokeInventoryActionMethod() {
        //  zoomCustomerToCenter('@ViewBag.Latitude', '@ViewBag.Longitude')
        $.ajax({
            type: "GET",
            url: '@Url.Action("GetCustomerGridDetails_NewHome", "GIS")', //** 30th march 2015 new func called
            data: GetAllFilterData(),
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            success: function (Data) {



                redrawMap();
                //if (isLegendDisplayed == false) {
                //    showLegendPanel();
                //    isLegendDisplayed = true;
                //    $('#legendPanel').scroll();

                //   // loadLegendDetails();
                //}

                //** Declare an array to hold all inventory layer markers
                var markerArr = [];

                //$.each(Data.Data, function (index, value) {
                //    markerArr.push(Data.Data[index]) //** This array contains lat and lng objects
                //});
                $.each(Data, function (index, value) {
                    if ((Data[index].Latitude == 0 || Data[index].Longitude == 0 || String(Data[index].Latitude) == "null" || String(Data[index].Longitude) == "null")) {
                        //** dont push records for the map
                    } else {
                        markerArr.push(Data[index]) //** This array contains lat and lng objects
                    }

                });


                // alert('ss'+markerArr.length)

                executeClearPOI_Inv() //** Clear all the OLD data POI on the map for the respective layers


                var layerValue = $("#layerDropDown").val();
                //  alert('rss' + markerArr.length)
                plotMarkers_Inventory(markerArr, legendImagesArr, "Home") //** '1' indicates inventory layer




            },
            error: function () {
                //alert("An error occurred while processing XML file.");
            }
        });

    }

    function executeClearPOI_Inv() {
        var layerValue = $("#layerDropDown").val();
        //** Clear all the OLD data POI on the map for the respective layers
        if (layerValue == 1) {
            clearMap(InvMarkerRepository, invMgr, InvPolygonRepository_Area, InvPolylineRepository_Area, InvPolygonRepository_Zone, InvPolylineRepository_Zone)
        } else if (layerValue == 2) {
            clearMap(HdbMarkerRepository, hdbMgr, HdbPolygonRepository_Area, HdbPolylineRepository_Area, HdbPolygonRepository_Zone, HdbPolylineRepository_Zone)
        } else if (layerValue == 3) {
            clearMap(PmoMarkerRepository, pmoMgr, PmoPolygonRepository_Area, PmoPolylineRepository_Area, PmoPolygonRepository_Zone, PmoPolylineRepository_Zone)
        }
    }

    function executeClearPOI_HDPB() {
        var layerValue = $("#layerDropDown").val();
        //** Clear all the OLD data POI on the map for the respective layers
        if (layerValue == 1) {
            //  clearMap(InvMarkerRepository, invMgr, InvPolygonRepository_Area, InvPolylineRepository_Area, InvPolygonRepository_Zone, InvPolylineRepository_Zone)
        } else if (layerValue == 2) {
            clearMap(HdbMarkerRepository, hdbMgr, HdbPolygonRepository_Area, HdbPolylineRepository_Area, HdbPolygonRepository_Zone, HdbPolylineRepository_Zone)
        } else if (layerValue == 3) {
            clearMap(PmoMarkerRepository, pmoMgr, PmoPolygonRepository_Area, PmoPolylineRepository_Area, PmoPolygonRepository_Zone, PmoPolylineRepository_Zone)
        }
    }

    function GetAllFilterData() {
        CustomerId = '@ViewBag.CurrentCityID';
        SpecificCriteria = -5;
        //alert('enabledAssetsArr' + enabledAssetsArr)
        AssetType = enabledAssetsArr.toString();//"11,32,31,1,10,0";
        AssetId = "";
        LocationTypeId = "";
        LocationTypeName = "All";
        ParallerLocationId = "";
        AssetStatus = "1";
        demZoneVal = "-1";
        SpecificCriteria = "-5";
        LayerValue = "1";
        AssetModelVal = "-1";
        NonComplianceIDVal = "1,2,3";

        return { customerId: CustomerId, assetType: AssetType, assetId: AssetId, locationTypeId: LocationTypeId, locationTypeName: LocationTypeName, parallerLocationId: ParallerLocationId, assetStatus: AssetStatus, demZone: demZoneVal, specificCriteria: SpecificCriteria, layerValue: LayerValue, assetModel: AssetModelVal, nonCompStatus: NonComplianceIDVal, pageChosen: "mapChosen" }
    }

    function GetAllFilterData_Parkingspaces() {

        CustomerId = '@ViewBag.CurrentCityID';
        SpecificCriteria = -5;
        //alert('enabledAssetsArr' + enabledAssetsArr)
        AssetType = enabledAssetsArr.toString();//"11,32,31,1,10,0";
        AssetId = "";
        LocationTypeId = "";
        LocationTypeName = "All";
        ParallerLocationId = "";
        AssetStatus = "1";
        demZoneVal = "-1";
        SpecificCriteria = "1,2";
        LayerValue = "2";
        AssetModelVal = "-1";
        NonComplianceIDVal = "1,2,3";
        complianceStatus = "All";


        return { customerId: CustomerId, assetType: AssetType, assetId: AssetId, locationTypeId: LocationTypeId, locationTypeName: LocationTypeName, parallerLocationId: ParallerLocationId, assetStatus: AssetStatus, demZone: demZoneVal, specificCriteria: SpecificCriteria, layerValue: LayerValue, assetModel: AssetModelVal, nonCompStatus: NonComplianceIDVal, complianceStatusIs: complianceStatus, pageChosen: "mapChosen" }



    }

    function getLegendDetails(xml, layerName) {
        $(xml).find(layerName).each(function () {
            $.each(this.attributes, function (i, attrib) {
                var name = attrib.name;
                var layerTitle = attrib.value;
                if (layerTitle == "High Demand Bays") {
                    layerTitle = "Parking Spaces";
                }
                $("<p id='ifwTitle'></p>").text(layerTitle).appendTo("#legendPanel");
            });
        });

        //** Append only the Enabled asset types to the Legend panel
        var enabledAssetNames = [];
        for (var i = 0; i < enabledAssetsArr.length; i++) {
            if (enabledAssetsArr[i] == 0) {
                //** It indicates SSM / Liberty
                enabledAssetNames.push("Single Space Meter")
            } else if (enabledAssetsArr[i] == 1) {
                //** It indicates MSM
                enabledAssetNames.push("Multiple Space Meter")
            } else if (enabledAssetsArr[i] == 10) {
                //** It indicates Sensor
                enabledAssetNames.push("Sensor")
            } else if (enabledAssetsArr[i] == 11) {
                //** It indicates Cashbox
                enabledAssetNames.push("Cashbox")
            } else if (enabledAssetsArr[i] == 20) {
                //** It indicates Parking Spaces
                enabledAssetNames.push("Parking Space")
            } else if (enabledAssetsArr[i] == 31) {
                //** It indicates Mechanisms
                enabledAssetNames.push("Mechanism")
            } else if (enabledAssetsArr[i] == 32) {
                //** It indicates Datakey
                enabledAssetNames.push("DataKey")
            }
        }

        $(xml).find(layerName).find("Item").each(function (index) {
            var legendName = $(this).find('LegendLabel').text();
            var legendImage = "@Url.Content("~/Images/")" + $(this).find('LegendImage').text();
            var img = $('<img style="float:left;margin-left:6px;"/>').attr({ 'id': legendName, 'src': legendImage, 'alt': legendName })
            if (layerName == "AssetColorCodes") {
                var imageLabel = $("<p style='font-size:13px;' id='ifw'>&nbsp;&nbsp;" + legendName + "</p>")
            } else {
                var imageLabel = $("<p style='line-height: 100%;font-size:13px;' id='ifw'>&nbsp;&nbsp;" + legendName + "</p>")
            }

            var imageHolder = $('<div style="display:inline";>').html(img);

            var legItem = $("<div style='width:210px;'></div>")

            //** add only enabled assets to legend panel
            var assetFound = false;
            for (var i = 0; i < enabledAssetNames.length; i++) {
                if (enabledAssetNames[i] == legendName) {
                    assetFound = true;
                    break;
                }
            }

            if (assetFound == true || (legendName == "Occupied" || legendName == "Vacant")) {
                //** It indicates only inventory layer and parking bays
                legItem.append(imageHolder)
                legItem.append(imageLabel)
                $("#legendPanel").append(legItem)
            }
        });
    }

    function drawStLine() {
        var legendImage = "@Url.Content("~/Images/stLine.png")";
        var img = $('<img style="float:left;margin-left:0px;"/>').attr({ 'id': 'stLiner', 'src': legendImage, 'alt': 'stLiner' })
        var imageHolder = $('<div style="display:inline";>').html(img);
        $("#legendPanel").append(imageHolder)
    }

    function loadLegendDetails() {
        $("#legendPanel").append("<div></div>");
        $.ajax({
            type: "GET",
            // url: "@Url.Content("~/legendDetails.xml")",
            url: "@Url.Content("~/Images/legendDetails.xml")",
            dataType: "xml",
            success: function (xml) {

                //** Inventory Layer legends (if any)
                getLegendDetails(xml, 'Inventory_Layer')
                drawStLine()


                //** High Demand Bays Layer legends (if any)
                getLegendDetails(xml, 'HighDemandBays_Layer');
                drawStLine()

                //** AssetColorCodes legends (if any)
                //var isDemZoneVisible = $("#demandZones").css('display');
                //if (isDemZoneVisible == "none") {
                //} else {
                //    getLegendDetails(xml, 'AssetColorCodes');
                //    drawStLine()
                //}


            },
            error: function () {
                alert("An error occurred while processing XML file.");
            }
        });

    }

    function TotalmeterCount() {
        //alert(1);

        $.ajax({
            type: "POST",
            dataType: "json",
            url: '@Url.Action("GetTotalAssetCount")',
            //contentType: "application/json; charset=utf-8",
            success: function (data) {
                $('#ttlmeterCount').text(data);
                //$('#ttlmeterCount').css("word-spacing:100px;");
                //$('#ttlmeterCount').after("   ");
                tMeter = data;
                meterCount();
            }
        })
    }
    function meterCount() {
        //alert(1);

        $.ajax({
            type: "POST",
            dataType: "json",
            url: '@Url.Action("GetActAssetCount")',
            //contentType: "application/json; charset=utf-8",
            success: function (data) {
                $('#meterCount').text(data);
                aMeter = data;
                ActivePercentage();
            }
        })
    }

    function ActivePercentage() {
        var res = 0;
        res = (100 / tMeter) * aMeter
        res = (res.toFixed(0))
        $('#ActivePercentage').text(res + "%");
        SeverAlarmCount();
        ActalarmCount();
    }

    @*function InActmeterCount() {
              //alert(1);

              $.ajax({
                  type: "POST",
                  dataType: "json",
                  url: '@Url.Action("GetInActAssetCount")',
                  //contentType: "application/json; charset=utf-8",
                  success: function (data1) {
                      //$("#InActmeterCount").text(data1);
                      $('#InActmeterCount').text("Inactive Meters : " + data1);

                  }
              })
          }*@

    function ActalarmCount() {
              //alert(1);

              $.ajax({
                  type: "POST",
                  dataType: "json",
                  url: '@Url.Action("GetActAlarmCount")',
                  //contentType: "application/json; charset=utf-8",
                  success: function (data) {
                      aaMeter = data;

                  }
              })
          }
    function SeverAlarmCount() {

        $.ajax({
            type: "POST",
            dataType: "json",
            url: '@Url.Action("GetSeverAlarmCount")',
            //contentType: "application/json; charset=utf-8",
            success: function (data) {
                $('#ActAlarmCount').text(data);
                MajorAlarmCount();
            }
        })
    }
    function MajorAlarmCount() {
        //alert(1);

        $.ajax({
            type: "POST",
            dataType: "json",
            url: '@Url.Action("GetMajorAlarmCount")',
            //contentType: "application/json; charset=utf-8",
            success: function (data) {
                $('#MajorAlarmCount').text(data);
                $('#MajorAlarmCount').css('height', '4px');
                MinorAlarmCount();
            }
        })
    }
    function MinorAlarmCount() {
        //alert(1);

        $.ajax({
            type: "POST",
            dataType: "json",
            url: '@Url.Action("GetMinorAlarmCount")',
            //contentType: "application/json; charset=utf-8",
            success: function (data) {
                $('#MinAlarmCount').text(data);
                $('#MinAlarmCount').css('height', '4px');
                InActalarmCount();
            }
        })
    }
    
    function InActalarmCount() {
        //alert(1);

        $.ajax({
            type: "POST",
            dataType: "json",
            url: '@Url.Action("GetInActAlarmCount")',
            //contentType: "application/json; charset=utf-8",
            success: function (data1) {
                $('#ClosedAlarms').text(data1);
                ActAlarmMeterPercentage();
            }
        })
    }

    function ActAlarmMeterPercentage() {
        //alert(1);
        var res = 0;
        res = (100 / aMeter) * aaMeter
        res = (res.toFixed(0))
        $('#ActAlarmPercengate').text(res + "%");
        ActCommMeterCount();

    }

    function ActCommMeterCount() {
        //alert(1);

        $.ajax({
            type: "POST",
            dataType: "json",
            url: '@Url.Action("GetCommMeters")',
            //contentType: "application/json; charset=utf-8",
            success: function (data1) {
                $('#ActCommCount').text(data1);
                cMeter = data1;
                CommMeterPercentage();
            }
        })
    }
    function CommMeterPercentage() {
        //alert(1);
        var res = 0;
        res = (100 / aMeter) * cMeter
        res = (res.toFixed(0))
        $('#CommPercengate').text(res + "%");
        ActNonCommMeterCount();
        
    }
    function ActNonCommMeterCount() {
        //alert(1);

        $.ajax({
            type: "POST",
            dataType: "json",
            url: '@Url.Action("GetNonCommMeters")',
            //contentType: "application/json; charset=utf-8",
            success: function (data1) {
                $('#ActNonCommCount').text(data1);
                BttrChangeRep();
            }
        })
    }
    function BttrChangeRep() {
        //alert(1);

        $.ajax({
            type: "POST",
            dataType: "json",
            url: '@Url.Action("GetBttrChangeRep")',
            //contentType: "application/json; charset=utf-8",
            success: function (data1) {
                $('#BttrChange').text(data1);
                lBattery = data1;
                PlanBttrChangeRep();
            }
        })
    }
    function PlanBttrChangeRep() {
        //alert(1);

        $.ajax({
            type: "POST",
            dataType: "json",
            url: '@Url.Action("GetBttrPlanChangeRep")',
            //contentType: "application/json; charset=utf-8",
            success: function (data1) {
                $('#PlanBttrChange').text(data1);
                LowBatteryPercentage();
            }
        })
    }
    function LowBatteryPercentage() {
        //alert(1);
        var res = 0;
        res = (100 / aMeter) * lBattery
        res = (res.toFixed(0))
        $('#BatteryPercengate').text(res + "%");
        ActNonCommMeterCount();

    }

      </script>
}

                     
@*<div class="two-column" id="news">*@
<div>
    @*<h2>@HttpContext.Current.GetLocaleResource(ResourceTypes.Glossary, "News and Announcements")</h2>
    <h3>@HttpContext.Current.GetLocaleResource(ResourceTypes.Glossary, "Today is") @String.Format("{0:D}", ViewData[Constants.ViewData.CurrentLocalTime]) </h3>
    
    <ul>
        @foreach (var newsItem in Model)
        {
            <li>
                <span style="font-style: italic">
                    @newsItem.EffectiveDate.ToShortDateString()
                </span>
                <br/>
                <span>
                    @Html.Raw(@HttpUtility.HtmlDecode(@newsItem.Content))
                </span>
            </li>
        }
    </ul>*@
    <p style="*margin-left:12px; font-family:Arial;font-weight:700;font-size:16px;height:12px;color:#075c87; float:left;">Inventory</p>
    <img style="margin-left:2px;margin-top:10px;" src="~/Images/downarrow.png" />
    <div id="DBHolder" >
        
        <div class="DB1" style="float:left;margin-left:-1px;  float:left;">
            <div style="height:30px;vertical-align:middle;">
             <p style="margin-left:4px;margin-top:7px;font-family:Arial;font-weight:600;font-size:13px;height:12px;color:#545351;float:left;">&nbsp;Locations&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
              <button class="today">Today</button>
            </div>
             <div style="border: 0.1px inset rgba(224, 224, 224, .5);width:229px;height:0.1px;"></div>
                <div>
                    @*<p style="margin-left:12px;margin-top:10px;font-family:Arial;font-weight:500;font-size:13px;height:5px;color:#73726e; float:left;">Total Locations&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
                    <p id="ttlmeterCount" style="margin-left:12px; margin-top:0px;font-family:arial;font-weight:500;font-size:13px;height:5px;color:#73726e;"></p>*@
                    <table>
                        <tr>
                            <td>&nbsp;&nbsp;Total Locations&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </td>
                            <td id="ttlmeterCount" style="margin-left: 12px; margin-top: 0px; font-family: arial; font-weight: 500; font-size: 13px; height: 5px; color: #73726e; padding-left: 10px;"></td>
                        </tr>
                        <tr>
                            <td>&nbsp;&nbsp;Locations Activated&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </td>
                            <td id="meterCount" style="margin-left:12px; margin-top:0px;font-family:arial;font-weight:500;font-size:13px;height:5px;color:#73726e; padding-left: 10px;"></td>
                        </tr>
                        <tr><td id="meterCount" style="margin-left:12px; margin-top:0px;font-family:arial;font-weight:500;font-size:13px;height:5px;color:#73726e;"></td>
                        </tr>
                        <tr><td id="meterCount" style="margin-left:12px; margin-top:0px;font-family:arial;font-weight:500;font-size:13px;height:5px;color:#73726e;"></td>
                        </tr>
                        <tr>
                            <td id="meterCount" style="margin-left:12px; margin-top:0px;font-family:arial;font-weight:500;font-size:13px;height:5px;color:#73726e;"></td>
                        </tr>
                        <tr>
                            <td id="meterCount" style="margin-left:12px; margin-top:0px;font-family:arial;font-weight:500;font-size:13px;height:5px;color:#73726e;"></td>
                        </tr>
                        <tr>
                            <td id="meterCount" style="margin-left:12px; margin-top:0px;font-family:arial;font-weight:500;font-size:13px;height:5px;color:#73726e;"></td>
                        </tr>
                        <tr>
                            <td id="meterCount" style="margin-left:12px; margin-top:0px;font-family:arial;font-weight:500;font-size:13px;height:5px;color:#73726e;"></td>
                        </tr>
                        <tr>
                            <td id="meterCount" style="margin-left:12px; margin-top:0px;font-family:arial;font-weight:500;font-size:13px;height:5px;color:#73726e;"></td>
                        </tr>
                        <tr>
                            <td id="meterCount" style="margin-left:12px; margin-top:0px;font-family:arial;font-weight:500;font-size:13px;height:5px;color:#73726e;"></td>
                        </tr>
                        <tr>
                            <td>&nbsp;&nbsp;<a href="@Url.Action("Index", "Assets")" class="elements"><span>Active Meters : </span></a></td>
                            <td id ="ActivePercentage" style="margin-left:4px;margin-top:21px;font-family:Arial;font-weight:900;font-size:14px;height:3px;color:#42a5d6; padding-left : 10px;"></td>
                        </tr>
                    </table>
                </div>
                
                @*<p id="meterCount" style="margin-left: 12px; margin-top: 10px; font-family: Arial; font-weight: 500; font-size: 13px; height: 5px; color: #73726e; clear: both;"> </p>*@
                @*<p id="InActmeterCount1" style="margin-left:12px;margin-top:10px;font-family:Arial;font-weight:500;font-size:13px;height:15px;color:#73726e"></p>*@
                @*<p style="margin-left:12px;margin-top:10px;font-family:Arial;font-weight:500;font-size:11px;height:5px;text-decoration:underline; color:#73726e;float:left;"><a href="@Url.Action("Index", "Assets")" class="elements"><span>Active Meters : </span></a></p>
                <p id="ActivePercentage" style="margin-left:4px;margin-top:21px;font-family:Arial;font-weight:900;font-size:14px;height:3px;color:#42a5d6"></p>*@
        </div>

        <div class="DB1" style="float:left;margin-left:3px;float:left;">
            <div style="height:30px;vertical-align:middle;">
                <p style="margin-left:4px;margin-top:7px;font-family:Arial;font-weight:600;font-size:13px;height:12px;color:#545351;float:left;">&nbsp;Alarms &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
                <button class="weekly">Current</button>
            </div>
            <div style="border: 0.1px inset rgba(224, 224, 224, .5);width:229px;height:0.0px;"></div>
            <div>
                <table>
                    <tr>
                        <td>&nbsp;&nbsp;Severe Alarms&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
                        <td id="ActAlarmCount" style="  margin-left:12px;margin-top:10px;font-family:Arial;font-weight:500;font-size:12px;height:4px;color:#73726e; padding-left : 42px;"></td>
                    </tr>
                    <tr>
                        <td>&nbsp;&nbsp;Major  Alarms&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
                        <td id="MajorAlarmCount" style="margin-left: 12px; margin-top: 10px; font-family: Arial; font-weight: 500; font-size: 12px; height: 4px; color: #73726e; padding-left: 42px; "></td>
                    </tr>
                    <tr>
                        <td>&nbsp;&nbsp;Minor Alarms&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </td>
                        <td id="MinAlarmCount" style="margin-left: 12px; margin-top: 10px; font-family: Arial; font-weight: 500; font-size: 12px; height: 4px; color: #73726e; padding-left: 42px; "></td>
                    </tr>
                    <tr>
                        <td>&nbsp;&nbsp;Closed Alarms&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </td>
                        <td id="ClosedAlarms" style="margin-left: 12px; margin-top: 10px; font-family: Arial; font-weight: 500; font-size: 12px; height: 4px; color: #73726e; padding-left: 42px; "></td>
                    </tr>
                    <tr>
                        <td>&nbsp;&nbsp;<a href="@Url.Action("Index", "Alarms")" class="elements"><span>Active Alarms : </span></a></td>
                        <td id="ActAlarmPercengate" style=" margin-top: 21px; font-family: Arial; font-weight: 900; font-size: 14px; height: 3px; color: #d41558; padding-left: 42px; "></td>
                    </tr>
                </table>
            </div>
        </div>

        <div class="DB1" style="float:left;margin-left:3px;float:left;">
            <div style="height:30px;vertical-align:middle;">
                <p style="margin-left:4px;margin-top:7px;font-family:Arial;font-weight:600;font-size:12px;height:13px;color:#545351;float:left;">&nbsp;&nbsp;Comms-No Comms&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
                <button class="todayGreen">Today</button>
            </div>
            <div style="border: 0.1px inset rgba(224, 224, 224, .5);width:229px;height:0.1px;"></div>
            <div>
                <table>
                    <tr>
                        <td>&nbsp;&nbsp;Communicating&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </td>
                        <td id="ActCommCount" style="margin-left:12px;margin-top:10px;font-family:Arial;font-weight:500;font-size:13px;height:5px;color:#73726e"></td>
                    </tr>
                    <tr>
                        <td>&nbsp;&nbsp;Non-Communicating&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </td>
                        <td id="ActNonCommCount" style="margin-left:12px;margin-top:10px;font-family:Arial;font-weight:500;font-size:13px;height:5px;color:#73726e"></td>
                    </tr>
                    <tr>
                        <td id="meterCount" style="margin-left:12px; margin-top:0px;font-family:arial;font-weight:500;font-size:13px;height:5px;color:#73726e;"></td>
                    </tr>
                    <tr>
                        <td id="meterCount" style="margin-left:12px; margin-top:0px;font-family:arial;font-weight:500;font-size:13px;height:5px;color:#73726e;"></td>
                    </tr>
                    <tr>
                        <td id="meterCount" style="margin-left:12px; margin-top:0px;font-family:arial;font-weight:500;font-size:13px;height:5px;color:#73726e;"></td>
                    </tr>
                    <tr>
                        <td id="meterCount" style="margin-left:12px; margin-top:0px;font-family:arial;font-weight:500;font-size:13px;height:5px;color:#73726e;"></td>
                    </tr>
                    <tr>
                        <td id="meterCount" style="margin-left:12px; margin-top:0px;font-family:arial;font-weight:500;font-size:13px;height:5px;color:#73726e;"></td>
                    </tr>
                    <tr>
                        <td id="meterCount" style="margin-left:12px; margin-top:0px;font-family:arial;font-weight:500;font-size:13px;height:5px;color:#73726e;"></td>
                    </tr>
                    <tr>
                        <td id="meterCount" style="margin-left:12px; margin-top:0px;font-family:arial;font-weight:500;font-size:13px;height:5px;color:#73726e;"></td>
                    </tr>
                    <tr>
                        <td id="meterCount" style="margin-left:12px; margin-top:0px;font-family:arial;font-weight:500;font-size:13px;height:5px;color:#73726e;"></td>
                    </tr>
                    <tr>
                        <td>&nbsp;&nbsp;<a href="@Url.Action("ReportAssetMaintenance", "Reports")" class="elements"><span>Communicating Meters : </span></a></td>
                        <td id="CommPercengate" style="margin-left: 4px; margin-top: 21px; font-family: Arial; font-weight: 900; font-size: 14px; height: 3px; color: #3ec770"></td>
                    </tr>
                </table>
            </div>
            @*<p id="ActCommCount" style="margin-left:12px;margin-top:10px;font-family:Arial;font-weight:500;font-size:13px;height:5px;color:#73726e"></p>
            <p id="ActNonCommCount" style="margin-left:12px;margin-top:10px;font-family:Arial;font-weight:500;font-size:13px;height:5px;color:#73726e"> </p>
            <p style="margin-left:12px;margin-top:10px;font-family:Arial;font-weight:500;font-size:13px;height:15px;color:#73726e">  &nbsp;   <b></b></p>
            <p style="margin-left:12px;margin-top:10px;font-family:Arial;font-weight:500;font-size:11px;height:5px;text-decoration:underline;color:#73726e;float:left;"><a href="@Url.Action("ReportAssetMaintenance", "Reports")" class="elements"><span>Communicating Meters : </span></a></p>

            <p id="CommPercengate" style="margin-left:8px;margin-top:21px;font-family:Arial;font-weight:900;font-size:14px;height:3px;color:#3ec770">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>*@
        </div>

        <div class="DB1" style="float:left;margin-left:3px;float:left;">
            <div style="height:30px;vertical-align:middle;">
                <p style="margin-left:4px;margin-top:7px;font-family:Arial;font-weight:600;font-size:13px;height:12px;color:#545351;float:left;">&nbsp;&nbsp;Battery Report &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
                <button class="todayOrange">Today</button>
            </div>
            <div style="border: 0.1px inset rgba(224, 224, 224, .5);width:229px;height:0.1px;"></div>
            <div>
                <table>
                    <tr>
                        <td>&nbsp;&nbsp;Change&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </td>
                        <td id="BttrChange" style=" margin-left: 12px; margin-top: 10px; font-family: Arial; font-weight: 500; font-size: 13px; height: 5px; color: #73726e; padding-left: 20px" ></td>
                    </tr>
                    <tr>
                        <td>&nbsp;&nbsp;Plan to Change&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </td>
                        <td id="PlanBttrChange" style=" margin-left: 12px; margin-top: 10px; font-family: Arial; font-weight: 500; font-size: 13px; height: 5px; color: #73726e; padding-left: 20px"></td>
                    </tr>
                    <tr>
                        <td id="meterCount" style=" margin-left: 12px; margin-top: 0px; font-family: arial; font-weight: 500; font-size: 13px; height: 5px; color: #73726e; "></td>
                    </tr>
                    <tr>
                        <td id="meterCount" style="margin-left:12px; margin-top:0px;font-family:arial;font-weight:500;font-size:13px;height:5px;color:#73726e;"></td>
                    </tr>
                    <tr>
                        <td id="meterCount" style="margin-left:12px; margin-top:0px;font-family:arial;font-weight:500;font-size:13px;height:5px;color:#73726e;"></td>
                    </tr>
                    <tr>
                        <td id="meterCount" style="margin-left:12px; margin-top:0px;font-family:arial;font-weight:500;font-size:13px;height:5px;color:#73726e;"></td>
                    </tr>
                    <tr>
                        <td id="meterCount" style="margin-left:12px; margin-top:0px;font-family:arial;font-weight:500;font-size:13px;height:5px;color:#73726e;"></td>
                    </tr>
                    <tr>
                        <td id="meterCount" style="margin-left:12px; margin-top:0px;font-family:arial;font-weight:500;font-size:13px;height:5px;color:#73726e;"></td>
                    </tr>
                    <tr>
                        <td id="meterCount" style="margin-left:12px; margin-top:0px;font-family:arial;font-weight:500;font-size:13px;height:5px;color:#73726e;"></td>
                    </tr>
                    <tr>
                        <td id="meterCount" style="margin-left:12px; margin-top:0px;font-family:arial;font-weight:500;font-size:13px;height:5px;color:#73726e;"></td>
                    </tr>
                    <tr>
                        <td>&nbsp;&nbsp;<a href="@Url.Action("ReportAssetMaintenance", "Reports")" class="elements"><span>Meters with Battery Issues: </span></a></td>
                        <td id="BatteryPercengate" style=" margin-left: 4px; margin-top: 21px; font-family: Arial; font-weight: 900; font-size: 14px; height: 3px; color: #ff6112; padding-left: 18px; "></td>
                    </tr>
                </table>
            </div>

            @*<p id="BttrChange" style="margin-left:12px;margin-top:10px;font-family:Arial;font-weight:500;font-size:13px;height:5px;color:#73726e"></p>
            <p id="PlanBttrChange" style="margin-left:12px;margin-top:10px;font-family:Arial;font-weight:500;font-size:13px;height:5px;color:#73726e"></p>
            <p style="margin-left:12px;margin-top:10px;font-family:Arial;font-weight:500;font-size:13px;height:15px;color:#73726e">  &nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;   <b></b></p>
            <p style="margin-left:12px;margin-top:10px;font-family:Arial;font-weight:500;font-size:11px;height:5px;text-decoration:underline;color:#73726e;float:left;"><a href="@Url.Action("ReportAssetMaintenance", "Reports")" class="elements"><span>Meters with Battery Issues : </span></a></p>
            <p id="BatteryPercengate" style="margin-left:8px;margin-top:21px;font-family:Arial;font-weight:900;font-size:13px;height:3px;color:#ff6112">&nbsp;&nbsp;</p>*@
        </div>
    </div>



    <!--Revenue Report-->

    


    <!--/////////////////////////////////////////////////////-->
    
   
</div>




<!-- Sairam added below line to display google map. Code added on Oct 8th 2014 -->
<div id="mHolder" style="float:none;clear:both; font-family:futura-pt-n4, futura-pt, Arial, sans-serif;">
    <div id="map_canvas" style=" max-height: 95%; min-height: 95%; height: 487px; margin: 2px; margin-top:8px; font-family:futura-pt-n4, futura-pt, Arial, sans-serif;"></div>

</div>

<div id="legendPanel">

</div>

<div id="legendTitle">
    <p>&nbsp;&nbsp;Legend Panel</p>
</div>
    
@section PageHeader 
{
    @{
        var userContext = new PEMRBACEntities();
        var username = User.Identity.Name;
        var user = userContext.UserProfiles.SingleOrDefault(u => u.UserName == username);
        <h1><span>@HttpContext.Current.GetLocaleResource(ResourceTypes.Glossary, "Welcome"), @String.Format("{0} {1}", user.FirstName, user.LastName)</span></h1>
    }
    @if (ViewBag.PWExpirationDays < 15)
    {
        <div class="message">
            <ul>
                <li>@HttpContext.Current.GetLocaleResource(ResourceTypes.Glossary, "Your password will expire in") @ViewBag.PWExpirationDays @HttpContext.Current.GetLocaleResource(ResourceTypes.Glossary, "day(s).")</li>
            </ul>
        </div>
    }

}

